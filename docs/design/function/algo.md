# 排位相关算法

用户评分 = 场次系数 X (原始评分[待修改] + (裸经验系数 X 裸经验 / 胜率系数) - 服务器修正 - 组队修正)

## 场次系数

基于船只场次来确定计算中的系数，同时为了确保排除极端值最低从 10 场的数据开始统计

场次系数的值在[0.1, 1]之间，关于中间部分基于函数生成，确保在低场次情况下不会对榜上数据产生较大影响

例如：a^c - b 这种函数形式

## 原始评分

评分的计算是基于服务器平均数据和用户实际数据。这里采用的算法是基于 numbers 的玩家算法

目前是整个评分算法中的主要占比，通过服务器数据来判断用户所在的分段

但是这个评分数据存在一定的问题，例如并不能正确展示用户在所有用户中的占比[后续算法需要修改的地方]

步骤 1 -比率：

```python
rDmg = actualDmg/expectedDmg
rWins = actualWins/expectedWins
rFrags = actualFrags/expectedFrags
```

步骤 2 -标准化：

```python
nDmg = max(0, (rDmg - 0.4) / (1 - 0.4))
nFrags = max(0, (rFrags - 0.1) / (1 - 0.1))
nWins = max(0, (rWins - 0.7) / (1 - 0.7))
```

步骤 3 - PR 值：

```python
PR = 700*nDMG + 300*nFrags + 150*nWins
```

此处获取到的原始评分值

## 游戏贡献评分

### 胜率系数

胜率系数是用于清洗裸经验中胜率对原始经验数据的影响

假设失败的胜率系数是 1，胜利的胜率系数为 1.5，那么我们就能通过用户的胜率来计算胜率系数

用户的胜率基于[0 - 100]这个区间内，那么胜率系数也同样位于[1 - 1.5]的区间

```python
cWins =(win_count X 1.5 + loss_count X 1) / battle_count
```

### 清洗裸经验数据

裸经验实际上就是 wg 对于用户的评分算法，但是这个数据非常复杂，涉及到较多的历史遗留问题，这个数据并不能直接使用

首先，胜率对裸经验的数据的影响非常的大，但是在上述的评分中原始 pr 已经包括有胜率相关的评分，所有首先需要将数据中胜率对原始裸经验数据的影响清洗掉，例如直接除去胜率系数

其次，因为算法中主要还是原始评分占比较大，所以需要乘以一个系数，或者计算服务器平均裸经验数据计算差值，再将数据相加

```python
cExp = index X (exp / cWins)

cExp = exp / cWins - expectedExp
```

## 服务器修正

基于服务器总数据和用户所在服务器的差值，计算原始评分的差值

也可以简单理解成，先计算总服务器平均数据的原始评分在计算所在服务器平均数据的原始评分，再计算差值

## 组队修正

是否组队对评分确实有很大的影响，但是需要考虑到的是，组队的影响不是一直都是好的。对于技术比较好的用户来说，收益就是正向收益。如果是萌新组队的话，收益就是反向的。

所有对于计算组队修正的思路，就是通过计算场次中组队的占比，如果胜率越高则修正越多

具体的修正值还需要大量数据拟合后才清楚
